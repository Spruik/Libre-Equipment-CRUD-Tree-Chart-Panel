{"version":3,"sources":["../src/update_node_ctrl.js"],"names":["updateNode","node","allData","panelCtrl","data","prepareModalData","utils","showModal","removeListeners","addListeners","self","maxlength","type","filter","d","site","reduce","arr","record","push","info","area","production_line","line","equipment","Array","from","Set","inputVal","name","$","document","off","on","input","serializeArray","value","isInputValid","startUpdate","alert","toLowerCase","indexOf","parent","url","writeLine","makeLine","normalUpdate","update","then","trigger","refresh","catch","l"],"mappings":"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","file":"update_node_ctrl.js","sourcesContent":["import * as utils from './utils'\r\nlet filter = []\r\n\r\nexport function updateNode (node, allData, panelCtrl) {\r\n  const data = prepareModalData(node, allData)\r\n  utils.showModal('update_node.html', data)\r\n  removeListeners()\r\n  addListeners(node, allData, panelCtrl)\r\n}\r\n\r\n/**\r\n * Update the reminder text based on the node's type\r\n * filter the distinct record of the same branch based on the node's type and push the value that match that type in the record to an array, this is for further validation purposes\r\n * @param {*} node\r\n * @param {*} allData\r\n */\r\nfunction prepareModalData (node, allData) {\r\n  let self\r\n  const maxlength = 50\r\n\r\n  if (node.type === 'Site') {\r\n    self = 'Site'\r\n    filter = allData.filter(d => d.site !== null)\r\n    filter = filter.reduce((arr, record) => {\r\n      arr.push(record.site)\r\n      return arr\r\n    }, [])\r\n  } else if (node.type === 'Area') {\r\n    self = 'Area'\r\n    filter = allData.filter(d => d.site === node.info.site && d.area !== null)\r\n    filter = filter.reduce((arr, record) => {\r\n      arr.push(record.area)\r\n      return arr\r\n    }, [])\r\n  } else if (node.type === 'Line') {\r\n    self = 'Line'\r\n    filter = allData.filter(d => d.site === node.info.site && d.area === node.info.area && d.production_line !== null)\r\n    filter = filter.reduce((arr, record) => {\r\n      arr.push(record.production_line)\r\n      return arr\r\n    }, [])\r\n  } else if (node.type === 'Equipment') {\r\n    self = 'Equipment'\r\n    filter = allData.filter(d => d.site === node.info.site && d.area === node.info.area && d.production_line === node.info.line && d.equipment !== null)\r\n    filter = filter.reduce((arr, record) => {\r\n      arr.push(record.equipment)\r\n      return arr\r\n    }, [])\r\n  }\r\n\r\n  filter = Array.from(new Set(filter))\r\n  return {\r\n    info: { self: self },\r\n    inputVal: node.name,\r\n    maxlength: maxlength\r\n  }\r\n}\r\n\r\nfunction removeListeners () {\r\n  $(document).off('click', '#master-data-reason-code-update-node-submitBtn')\r\n}\r\n\r\nfunction addListeners (node, allData, panelCtrl) {\r\n  $(document).on('click', '#master-data-reason-code-update-node-submitBtn', e => {\r\n    const input = $('#master-data-reason-code-update-node-form').serializeArray()[0].value\r\n    if (isInputValid(input, node)) {\r\n      // valid\r\n      startUpdate(input, node, panelCtrl)\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * Check if input is empty\r\n * Check if input has changed\r\n * Check if input is already exist within the same parent\r\n * @param {*} input\r\n * @param {*} node\r\n */\r\nfunction isInputValid (input, node) {\r\n  if (input === '') {\r\n    utils.alert('warning', 'Warning', 'Input Required')\r\n    return false\r\n  }\r\n\r\n  if (input === node.name) {\r\n    utils.alert('warning', 'Warning', 'Change Required')\r\n    return false\r\n  }\r\n\r\n  filter = filter.reduce((arr, d) => {\r\n    arr.push(d.toLowerCase())\r\n    return arr\r\n  }, [])\r\n\r\n  if (filter.indexOf(input.toLowerCase()) !== -1) {\r\n    utils.alert('warning', 'Warning', node.type + ' exists')\r\n    return false\r\n  }\r\n\r\n  return true\r\n}\r\n\r\n/**\r\n * Prepare urls and lines for the update\r\n * @param {*} input\r\n * @param {*} node\r\n * @param {*} panelCtrl\r\n */\r\nfunction startUpdate (input, node, panelCtrl) {\r\n  if (input === node.parent) {\r\n    utils.alert('warning', 'Warning', \"The name cannot be the same as its parent's name\")\r\n    return\r\n  }\r\n  const url = utils.writeLine(node)\r\n  const line = makeLine(input, node)\r\n  normalUpdate(url, line, panelCtrl)\r\n}\r\n\r\n/**\r\n * Url will locate all records matching this url condition\r\n * Line is the update argument that is used to update all those records\r\n * popup successful, close the form, and refresh the tree when it's finished\r\n * popup error, close the form when it failed\r\n * @param {*} url\r\n * @param {*} line\r\n * @param {*} panelCtrl\r\n */\r\nfunction normalUpdate (url, line, panelCtrl) {\r\n  utils.update(url, line).then(res => {\r\n    // console.log(res)\r\n    $('#master-data-reason-code-update-node-cancelBtn').trigger('click')\r\n    utils.alert('success', 'Success', 'A new node has been succeesfully inserted')\r\n    panelCtrl.refresh()\r\n  }).catch(e => {\r\n    // console.log(e)\r\n    $('#master-data-reason-code-update-node-cancelBtn').trigger('click')\r\n    utils.alert('error', 'Error', 'Error ocurred whiling inserting node into the database, please try agian')\r\n  })\r\n}\r\n\r\n/**\r\n * Make the update line based on the node type.\r\n * @param {*} input\r\n * @param {*} node\r\n */\r\nfunction makeLine (input, node) {\r\n  let l = ''\r\n  if (node.type === 'Site') {\r\n    l = 'site=' + input\r\n  } else if (node.type === 'Area') {\r\n    l = 'area=' + input\r\n  } else if (node.type === 'Line') {\r\n    l = 'production_line=' + input\r\n  } else if (node.type === 'Equipment') {\r\n    l = 'equipment=' + input\r\n  }\r\n  return l\r\n}\r\n"]}