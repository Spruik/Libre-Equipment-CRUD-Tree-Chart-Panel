{"version":3,"sources":["../src/add_child_ctrl.js"],"names":["addChild","node","allData","panelCtrl","data","prepareModalData","utils","showModal","removeListeners","addListeners","sub","self","placeholder","maxLength","type","filter","d","site","reduce","arr","record","push","name","area","info","production_line","equipment","line","Array","from","Set","child","$","document","on","input","serializeArray","value","alert","isInputAvailable","insertNode","off","toLowerCase","indexOf","writeInsertionLine","url","postgRestHost","post","then","closeForm","refresh","catch","trigger"],"mappings":";;;;;;AAQO,WAASA,QAAT,CAAmBC,IAAnB,EAAyBC,OAAzB,EAAkCC,SAAlC,EAA6C;AAClD,QAAMC,OAAOC,iBAAiBJ,IAAjB,EAAuBC,OAAvB,CAAb;AACAI,UAAMC,SAAN,CAAgB,gBAAhB,EAAkCH,IAAlC;AACAI;AACAC,iBAAaR,IAAb,EAAmBC,OAAnB,EAA4BC,SAA5B;AACD;;sBALeH,Q;;AAOhB,WAASK,gBAAT,CAA2BJ,IAA3B,EAAiCC,OAAjC,EAA0C;AACxC,QAAIQ,YAAJ;AAAA,QAASC,aAAT;AACA,QAAIC,oBAAJ;AACA,QAAMC,YAAY,EAAlB;AACA;;AAEA,QAAIZ,KAAKa,IAAL,KAAc,MAAlB,EAA0B;AACxBJ,YAAM,MAAN;AACAC,aAAO,MAAP;AACAC,oBAAc,mBAAd;AACAG,eAASb,QAAQa,MAAR,CAAe;AAAA,eAAKC,EAAEC,IAAF,KAAW,IAAhB;AAAA,OAAf,CAAT;AACAF,eAASA,OAAOG,MAAP,CAAc,UAACC,GAAD,EAAMC,MAAN,EAAiB;AACtCD,YAAIE,IAAJ,CAASD,OAAOH,IAAhB;AACA,eAAOE,GAAP;AACD,OAHQ,EAGN,EAHM,CAAT;AAID,KATD,MASO,IAAIlB,KAAKa,IAAL,KAAc,MAAlB,EAA0B;AAC/BJ,YAAM,MAAN;AACAC,aAAO,iBAAiBV,KAAKqB,IAA7B;AACAV,oBAAc,oBAAd;AACAG,eAASb,QAAQa,MAAR,CAAe;AAAA,eAAKC,EAAEC,IAAF,KAAW,IAAX,IAAmBD,EAAEO,IAAF,KAAW,IAA9B,IAAsCP,EAAEC,IAAF,KAAWhB,KAAKuB,IAAL,CAAUP,IAAhE;AAAA,OAAf,CAAT;AACAF,eAASA,OAAOG,MAAP,CAAc,UAACC,GAAD,EAAMC,MAAN,EAAiB;AACtCD,YAAIE,IAAJ,CAASD,OAAOG,IAAhB;AACA,eAAOJ,GAAP;AACD,OAHQ,EAGN,EAHM,CAAT;AAID,KATM,MASA,IAAIlB,KAAKa,IAAL,KAAc,MAAlB,EAA0B;AAC/BJ,YAAM,MAAN;AACAC,aAAO,iBAAiBV,KAAKqB,IAA7B;AACAV,oBAAc,mBAAd;AACAG,eAASb,QAAQa,MAAR,CAAe;AAAA,eAAKC,EAAEC,IAAF,KAAW,IAAX,IAAmBD,EAAEC,IAAF,KAAWhB,KAAKuB,IAAL,CAAUP,IAAxC,IAAgDD,EAAEO,IAAF,KAAW,IAA3D,IAAmEP,EAAEO,IAAF,KAAWtB,KAAKuB,IAAL,CAAUD,IAAxF,IAAgGP,EAAES,eAAF,KAAsB,IAA3H;AAAA,OAAf,CAAT;AACAV,eAASA,OAAOG,MAAP,CAAc,UAACC,GAAD,EAAMC,MAAN,EAAiB;AACtCD,YAAIE,IAAJ,CAASD,OAAOK,eAAhB;AACA,eAAON,GAAP;AACD,OAHQ,EAGN,EAHM,CAAT;AAID,KATM,MASA,IAAIlB,KAAKa,IAAL,KAAc,MAAlB,EAA0B;AAC/BJ,YAAM,WAAN;AACAC,aAAO,iBAAiBV,KAAKqB,IAA7B;AACAV,oBAAc,yBAAd;AACAG,eAASb,QAAQa,MAAR,CAAe;AAAA,eAAKC,EAAEU,SAAF,KAAgB,IAAhB,IAAwBV,EAAEC,IAAF,KAAWhB,KAAKuB,IAAL,CAAUP,IAA7C,IAAqDD,EAAEO,IAAF,KAAWtB,KAAKuB,IAAL,CAAUD,IAA1E,IAAkFP,EAAES,eAAF,KAAsBxB,KAAKuB,IAAL,CAAUG,IAAvH;AAAA,OAAf,CAAT;AACAZ,eAASA,OAAOG,MAAP,CAAc,UAACC,GAAD,EAAMC,MAAN,EAAiB;AACtCD,YAAIE,IAAJ,CAASD,OAAOM,SAAhB;AACA,eAAOP,GAAP;AACD,OAHQ,EAGN,EAHM,CAAT;AAID;;AAEDJ,aAASa,MAAMC,IAAN,CAAW,IAAIC,GAAJ,CAAQf,MAAR,CAAX,CAAT;;AAEA,WAAO;AACLS,YAAM;AACJO,eAAOrB,GADH;AAEJC,cAAMA;AAFF,OADD;AAKLC,mBAAaA,WALR;AAMLC,iBAAWA;AANN,KAAP;AAQD;;AAED,WAASJ,YAAT,CAAuBR,IAAvB,EAA6BC,OAA7B,EAAsCC,SAAtC,EAAiD;AAC/C6B,MAAEC,QAAF,EAAYC,EAAZ,CAAe,OAAf,EAAwB,8CAAxB,EAAwE,aAAK;AAC3E,UAAMC,QAAQH,EAAE,yCAAF,EAA6CI,cAA7C,EAAd;AACA,UAAID,MAAM,CAAN,EAASE,KAAT,KAAmB,EAAvB,EAA2B;AACzB/B,cAAMgC,KAAN,CAAY,SAAZ,EAAuB,SAAvB,EAAkC,gBAAlC;AACD,OAFD,MAEO;AACL,YAAIC,iBAAiBJ,MAAM,CAAN,EAASE,KAA1B,CAAJ,EAAsC;AACpCG,qBAAWL,MAAM,CAAN,EAASE,KAApB,EAA2BpC,IAA3B,EAAiCE,SAAjC;AACD;AACF;AACF,KATD;AAUD;;AAED,WAASK,eAAT,GAA4B;AAC1BwB,MAAEC,QAAF,EAAYQ,GAAZ,CAAgB,OAAhB,EAAyB,8CAAzB;AACD;;AAED;;;;AAIA,WAASF,gBAAT,CAA2BJ,KAA3B,EAAkC;AAChC;AACApB,aAASA,OAAOG,MAAP,CAAc,UAACC,GAAD,EAAMH,CAAN,EAAY;AACjCG,UAAIE,IAAJ,CAASL,EAAE0B,WAAF,EAAT;AACA,aAAOvB,GAAP;AACD,KAHQ,EAGN,EAHM,CAAT;;AAKA,QAAIJ,OAAO4B,OAAP,CAAeR,MAAMO,WAAN,EAAf,MAAwC,CAAC,CAA7C,EAAgD;AAC9CpC,YAAMgC,KAAN,CAAY,SAAZ,EAAuB,SAAvB,EAAkC,cAAlC;AACA,aAAO,KAAP;AACD;;AAED,WAAO,IAAP;AACD;;AAED,WAASE,UAAT,CAAqBL,KAArB,EAA4BlC,IAA5B,EAAkCE,SAAlC,EAA6C;AAC3C,QAAIgC,UAAUlC,KAAKqB,IAAnB,EAAyB;AACvBhB,YAAMgC,KAAN,CAAY,SAAZ,EAAuB,SAAvB,EAAkC,+DAAlC;AACA;AACD;AACD,QAAMX,OAAOiB,mBAAmBT,KAAnB,EAA0BlC,IAA1B,CAAb;AACA,QAAM4C,MAAMvC,MAAMwC,aAAN,GAAsB,WAAlC;AACAxC,UAAMyC,IAAN,CAAWF,GAAX,EAAgBlB,IAAhB,EACGqB,IADH,CACQ,eAAO;AACX;AACAC;AACA3C,YAAMgC,KAAN,CAAY,SAAZ,EAAuB,SAAvB,EAAkC,2CAAlC;AACAnC,gBAAU+C,OAAV;AACD,KANH,EAOGC,KAPH,CAOS,aAAK;AACV;AACAF;AACA3C,YAAMgC,KAAN,CACE,OADF,EAEE,OAFF,EAGE,0EAHF;AAKD,KAfH;AAgBD;;AAED,WAASM,kBAAT,CAA6BT,KAA7B,EAAoClC,IAApC,EAA0C;AACxC,QAAI0B,OAAO,EAAX;;AAEA,QAAI1B,KAAKa,IAAL,KAAc,MAAlB,EAA0B;AACxBa,aAAO,UAAUQ,KAAjB;AACD,KAFD,MAEO,IAAIlC,KAAKa,IAAL,KAAc,MAAlB,EAA0B;AAC/Ba,aAAO,UAAU1B,KAAKuB,IAAL,CAAUP,IAApB,GAA2B,QAA3B,GAAsCkB,KAA7C;AACD,KAFM,MAEA,IAAIlC,KAAKa,IAAL,KAAc,MAAlB,EAA0B;AAC/Ba,aAAO,UAAU1B,KAAKuB,IAAL,CAAUP,IAApB,GAA2B,QAA3B,GAAsChB,KAAKuB,IAAL,CAAUD,IAAhD,GAAuD,mBAAvD,GAA6EY,KAApF;AACD,KAFM,MAEA,IAAIlC,KAAKa,IAAL,KAAc,MAAlB,EAA0B;AAC/Ba,aAAO,UAAU1B,KAAKuB,IAAL,CAAUP,IAApB,GAA2B,QAA3B,GAAsChB,KAAKuB,IAAL,CAAUD,IAAhD,GAAuD,mBAAvD,GAA6EtB,KAAKuB,IAAL,CAAUG,IAAvF,GAA8F,aAA9F,GAA8GQ,KAArH;AACD;AACD,WAAOR,IAAP;AACD;;;AAjJWrB,W;;;AAERS,Y,GAAS,E;;AAEPkC,e,GAAY,SAAZA,SAAY,GAAM;AACtBjB,UAAE,8CAAF,EAAkDoB,OAAlD,CAA0D,OAA1D;AACD,O","file":"add_child_ctrl.js","sourcesContent":["import * as utils from './utils'\r\n\r\nlet filter = []\r\n\r\nconst closeForm = () => {\r\n  $('#master-data-reason-code-add-child-cancelBtn').trigger('click')\r\n}\r\n\r\nexport function addChild (node, allData, panelCtrl) {\r\n  const data = prepareModalData(node, allData)\r\n  utils.showModal('add_child.html', data)\r\n  removeListeners()\r\n  addListeners(node, allData, panelCtrl)\r\n}\r\n\r\nfunction prepareModalData (node, allData) {\r\n  let sub, self\r\n  let placeholder\r\n  const maxLength = 12\r\n  // console.log(allData);\r\n\r\n  if (node.type === 'Root') {\r\n    sub = 'Site'\r\n    self = 'Root'\r\n    placeholder = 'Enter a Site here'\r\n    filter = allData.filter(d => d.site !== null)\r\n    filter = filter.reduce((arr, record) => {\r\n      arr.push(record.site)\r\n      return arr\r\n    }, [])\r\n  } else if (node.type === 'Site') {\r\n    sub = 'Area'\r\n    self = 'Site called ' + node.name\r\n    placeholder = 'Enter an Area here'\r\n    filter = allData.filter(d => d.site !== null && d.area !== null && d.site === node.info.site)\r\n    filter = filter.reduce((arr, record) => {\r\n      arr.push(record.area)\r\n      return arr\r\n    }, [])\r\n  } else if (node.type === 'Area') {\r\n    sub = 'Line'\r\n    self = 'Area called ' + node.name\r\n    placeholder = 'Enter a Line here'\r\n    filter = allData.filter(d => d.site !== null && d.site === node.info.site && d.area !== null && d.area === node.info.area && d.production_line !== null)\r\n    filter = filter.reduce((arr, record) => {\r\n      arr.push(record.production_line)\r\n      return arr\r\n    }, [])\r\n  } else if (node.type === 'Line') {\r\n    sub = 'Equipment'\r\n    self = 'Line called ' + node.name\r\n    placeholder = 'Enter an Equipment here'\r\n    filter = allData.filter(d => d.equipment !== null && d.site === node.info.site && d.area === node.info.area && d.production_line === node.info.line)\r\n    filter = filter.reduce((arr, record) => {\r\n      arr.push(record.equipment)\r\n      return arr\r\n    }, [])\r\n  }\r\n\r\n  filter = Array.from(new Set(filter))\r\n\r\n  return {\r\n    info: {\r\n      child: sub,\r\n      self: self\r\n    },\r\n    placeholder: placeholder,\r\n    maxLength: maxLength\r\n  }\r\n}\r\n\r\nfunction addListeners (node, allData, panelCtrl) {\r\n  $(document).on('click', '#master-data-reason-code-add-child-submitBtn', e => {\r\n    const input = $('#master-data-reason-code-add-child-form').serializeArray()\r\n    if (input[0].value === '') {\r\n      utils.alert('warning', 'Warning', 'Input Required')\r\n    } else {\r\n      if (isInputAvailable(input[0].value)) {\r\n        insertNode(input[0].value, node, panelCtrl)\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nfunction removeListeners () {\r\n  $(document).off('click', '#master-data-reason-code-add-child-submitBtn')\r\n}\r\n\r\n/**\r\n * Check if the user input has already been exist in the same parent node.\r\n * @param {*} input\r\n */\r\nfunction isInputAvailable (input) {\r\n  // console.log(filter);\r\n  filter = filter.reduce((arr, d) => {\r\n    arr.push(d.toLowerCase())\r\n    return arr\r\n  }, [])\r\n\r\n  if (filter.indexOf(input.toLowerCase()) !== -1) {\r\n    utils.alert('warning', 'Warning', 'Child exists')\r\n    return false\r\n  }\r\n\r\n  return true\r\n}\r\n\r\nfunction insertNode (input, node, panelCtrl) {\r\n  if (input === node.name) {\r\n    utils.alert('warning', 'Warning', \"The child node's name cannot be the same as its parent's name\")\r\n    return\r\n  }\r\n  const line = writeInsertionLine(input, node)\r\n  const url = utils.postgRestHost + 'equipment'\r\n  utils.post(url, line)\r\n    .then(res => {\r\n      // console.log(res)\r\n      closeForm()\r\n      utils.alert('success', 'Success', 'A new node has been succeesfully inserted')\r\n      panelCtrl.refresh()\r\n    })\r\n    .catch(e => {\r\n      // console.log(e);\r\n      closeForm()\r\n      utils.alert(\r\n        'error',\r\n        'Error',\r\n        'Error ocurred whiling inserting node into the database, please try agian'\r\n      )\r\n    })\r\n}\r\n\r\nfunction writeInsertionLine (input, node) {\r\n  let line = ''\r\n\r\n  if (node.type === 'Root') {\r\n    line = 'site=' + input\r\n  } else if (node.type === 'Site') {\r\n    line = 'site=' + node.info.site + '&area=' + input\r\n  } else if (node.type === 'Area') {\r\n    line = 'site=' + node.info.site + '&area=' + node.info.area + '&production_line=' + input\r\n  } else if (node.type === 'Line') {\r\n    line = 'site=' + node.info.site + '&area=' + node.info.area + '&production_line=' + node.info.line + '&equipment=' + input\r\n  }\r\n  return line\r\n}\r\n"]}