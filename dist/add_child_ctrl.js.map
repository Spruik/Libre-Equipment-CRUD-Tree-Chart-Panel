{"version":3,"sources":["../src/add_child_ctrl.js"],"names":["addChild","node","allData","panelCtrl","data","prepareModalData","utils","showModal","removeListeners","addListeners","sub","self","placeholder","maxLength","type","filter","d","site","reduce","arr","record","push","name","area","info","production_line","equipment","line","Array","from","Set","child","$","document","on","input","serializeArray","value","alert","isInputAvailable","insertNode","off","toLowerCase","indexOf","writeInsertionLine","url","postgRestHost","post","then","closeForm","refresh","catch","angular","trigger"],"mappings":"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","file":"add_child_ctrl.js","sourcesContent":["import { alert, showModal, post, postgRestHost } from './utils'\nimport * as utils from './utils'\nimport angular from 'angular'\n\nlet filter = []\n\nconst closeForm = () => {\n  $('#master-data-reason-code-add-child-cancelBtn').trigger('click')\n}\n\nexport function addChild (node, allData, panelCtrl) {\n  let data = prepareModalData(node, allData)\n  utils.showModal('add_child.html', data)\n  removeListeners()\n  addListeners(node, allData, panelCtrl)\n}\n\nfunction prepareModalData (node, allData) {\n  let sub, self\n  let placeholder\n  let maxLength = 12\n  // console.log(allData);\n  \n  if (node.type === 'Root') {\n    sub = 'Site'\n    self = 'Root'\n    placeholder = 'Enter a Site here'\n    filter = allData.filter(d => d.site !== null)\n    filter = filter.reduce((arr, record) => {\n      arr.push(record.site)\n      return arr\n    }, [])\n  }else if (node.type === 'Site') {\n    sub = 'Area'\n    self = 'Site called ' + node.name\n    placeholder = 'Enter an Area here'\n    filter = allData.filter(d => d.site !== null && d.area !== null && d.site === node.info.site)\n    filter = filter.reduce((arr, record) => {\n      arr.push(record.area)\n      return arr\n    }, [])\n  }else if (node.type === 'Area') {\n    sub = 'Line'\n    self = 'Area called ' + node.name\n    placeholder = 'Enter a Line here'\n    filter = allData.filter( d => d.site !== null && d.site === node.info.site && d.area !== null && d.area === node.info.area && d.production_line !== null)\n    filter = filter.reduce((arr, record) => {\n      arr.push(record.production_line)\n      return arr\n    }, [])\n  }else if (node.type === 'Line') {\n    sub = 'Equipment'\n    self = 'Line called ' + node.name\n    placeholder = 'Enter an Equipment here'\n    filter = allData.filter( d => d.equipment !== null && d.site === node.info.site && d.area === node.info.area && d.production_line === node.info.line)\n    filter = filter.reduce((arr, record) => {\n      arr.push(record.equipment)\n      return arr\n    }, [])\n  }\n\n  filter = Array.from(new Set(filter))\n\n  return {\n    info: {\n      child: sub,\n      self: self\n    },\n    placeholder: placeholder,\n    maxLength: maxLength\n  }\n}\n\nfunction addListeners (node, allData, panelCtrl) {\n  $(document).on('click', '#master-data-reason-code-add-child-submitBtn', e => {\n    const input = $('#master-data-reason-code-add-child-form').serializeArray()\n    if (input[0].value === '') {\n      utils.alert('warning', 'Warning', 'Input Required')\n    } else {\n      if (isInputAvailable(input[0].value)) {\n        insertNode(input[0].value, node, panelCtrl)\n      }\n    }\n  })\n}\n\nfunction removeListeners () {\n  $(document).off('click', '#master-data-reason-code-add-child-submitBtn')\n}\n\n/**\n * Check if the user input has already been exist in the same parent node.\n * @param {*} input\n */\nfunction isInputAvailable (input) {\n  // console.log(filter);\n  filter = filter.reduce((arr, d) => {\n    arr.push(d.toLowerCase())\n    return arr\n  }, [])\n\n  if (filter.indexOf(input.toLowerCase()) !== -1) {\n    utils.alert('warning', 'Warning', 'Child exists')\n    return false\n  }\n\n  return true\n}\n\nfunction insertNode (input, node, panelCtrl) {\n  if (input === node.name) {\n    alert('warning', 'Warning', \"The child node's name cannot be the same as its parent's name\")\n    return\n  }\n  const line = writeInsertionLine(input, node)\n  const url = postgRestHost + 'equipment'\n  post(url, line)\n    .then(res => {\n      // console.log(res)\n      closeForm()\n      utils.alert('success', 'Success', 'A new node has been succeesfully inserted')\n      panelCtrl.refresh()\n    })\n    .catch(e => {\n      // console.log(e);\n      closeForm()\n      utils.alert(\n        'error',\n        'Error',\n        'Error ocurred whiling inserting node into the database, please try agian'\n      )\n    })\n  \n}\n\nfunction writeInsertionLine (input, node) {\n  let line = ''\n\n  if (node.type === 'Root') {\n    line = 'site=' + input\n  }else if (node.type === 'Site') {\n    line = 'site=' + node.info.site + '&area=' + input\n  }else if (node.type === 'Area') {\n    line = 'site=' + node.info.site + '&area=' + node.info.area + '&production_line=' + input\n  }else if (node.type === 'Line') {\n    line = 'site=' + node.info.site + '&area=' + node.info.area + '&production_line=' + node.info.line + '&equipment=' + input\n  }\n\n  return line\n}\n"]}