{"version":3,"sources":["../src/crud_ctrl.js"],"names":["showCrudPopup","data","panelCtrl","allData","utils","showModal","removeListeners","addListeners","$","document","on","e","target","id","type","alert","trigger","addChild","updateNode","deleteNode","off","node","url","writeLine","deleteMethod","then","refresh","catch"],"mappings":";;;;;;AAIO,WAASA,aAAT,CAAwBC,IAAxB,EAA8BC,SAA9B,EAAyCC,OAAzC,EAAkD;AACvDC,UAAMC,SAAN,CAAgB,mBAAhB;AACAC;AACAC,iBAAaN,IAAb,EAAmBC,SAAnB,EAA8BC,OAA9B;AACD;;2BAJeH,a;;AAMhB,WAASO,YAAT,CAAuBN,IAAvB,EAA6BC,SAA7B,EAAwCC,OAAxC,EAAiD;AAC/CK,MAAEC,QAAF,EAAYC,EAAZ,CAAe,OAAf,EAAwB,oEAAxB,EAA8F,aAAK;AACjG,UAAIC,EAAEC,MAAF,CAASC,EAAT,KAAgB,KAApB,EAA2B;AACzB;AACA,YAAIZ,KAAKa,IAAL,KAAc,WAAlB,EAA+B;AAC7BV,gBAAMW,KAAN,CAAY,SAAZ,EAAuB,SAAvB,EAAkC,0CAAlC;AACAP,YAAE,4CAAF,EAAgDQ,OAAhD,CAAwD,OAAxD;AACD,SAHD,MAGO;AACLC,mBAAShB,IAAT,EAAeE,OAAf,EAAwBD,SAAxB;AACD;AACF,OARD,MAQO,IAAIS,EAAEC,MAAF,CAASC,EAAT,KAAgB,QAApB,EAA8B;AACnC,YAAIZ,KAAKa,IAAL,KAAc,MAAlB,EAA0B;AACxBV,gBAAMW,KAAN,CAAY,SAAZ,EAAuB,SAAvB,EAAkC,2BAAlC;AACAP,YAAE,4CAAF,EAAgDQ,OAAhD,CAAwD,OAAxD;AACD,SAHD,MAGO;AACLE,qBAAWjB,IAAX,EAAiBE,OAAjB,EAA0BD,SAA1B;AACD;AACF,OAPM,MAOA,IAAIS,EAAEC,MAAF,CAASC,EAAT,KAAgB,QAApB,EAA8B;AACnC,YAAIZ,KAAKa,IAAL,KAAc,MAAlB,EAA0B;AACxBV,gBAAMW,KAAN,CAAY,SAAZ,EAAuB,SAAvB,EAAkC,2BAAlC;AACAP,YAAE,4CAAF,EAAgDQ,OAAhD,CAAwD,OAAxD;AACD,SAHD,MAGO;AACLZ,gBAAMC,SAAN,CAAgB,qBAAhB;AACD;AACF;AACF,KAxBD;;AA0BAG,MAAEC,QAAF,EAAYC,EAAZ,CAAe,OAAf,EAAwB,0DAAxB,EAAoF,aAAK;AACvFS,iBAAWlB,IAAX,EAAiBC,SAAjB;AACD,KAFD;AAGD;;AAED,WAASI,eAAT,GAA4B;AAC1BE,MAAEC,QAAF,EAAYW,GAAZ,CAAgB,OAAhB,EAAyB,oEAAzB;AACAZ,MAAEC,QAAF,EAAYW,GAAZ,CAAgB,OAAhB,EAAyB,0DAAzB;AACD;;AAED,WAASD,UAAT,CAAqBE,IAArB,EAA2BnB,SAA3B,EAAsC;AACpC,QAAMoB,MAAMlB,MAAMmB,SAAN,CAAgBF,IAAhB,CAAZ;AACA,QAAIC,GAAJ,EAAS;AACP;AACAlB,YAAMoB,YAAN,CAAmBF,GAAnB,EAAwBG,IAAxB,CAA6B,eAAO;AAClC;AACAjB,UAAE,yDAAF,EAA6DQ,OAA7D,CAAqE,OAArE;AACAZ,cAAMW,KAAN,CAAY,SAAZ,EAAuB,kBAAvB,EAA2C,8DAA3C;AACAb,kBAAUwB,OAAV;AACD,OALD,EAKGC,KALH,CAKS,aAAK;AACZ;AACAnB,UAAE,yDAAF,EAA6DQ,OAA7D,CAAqE,OAArE;AACAZ,cAAMW,KAAN,CAAY,OAAZ,EAAqB,OAArB,EAA8B,4EAA9B;AACD,OATD;AAUD;AACF;;;AA9DQE,c,mBAAAA,Q;;AACAC,gB,qBAAAA,U;;AACGd,W","file":"crud_ctrl.js","sourcesContent":["import { addChild } from './add_child_ctrl'\r\nimport { updateNode } from './update_node_ctrl'\r\nimport * as utils from './utils'\r\n\r\nexport function showCrudPopup (data, panelCtrl, allData) {\r\n  utils.showModal('crud_options.html')\r\n  removeListeners()\r\n  addListeners(data, panelCtrl, allData)\r\n}\r\n\r\nfunction addListeners (data, panelCtrl, allData) {\r\n  $(document).on('click', 'input[type=\"button\"][name=\"master-data-reason-code-actions-radio\"]', e => {\r\n    if (e.target.id === 'add') {\r\n      // equipment is the last node, no chilren are allowed to be added to equipment\r\n      if (data.type === 'Equipment') {\r\n        utils.alert('warning', 'Warning', 'Adding child to Equipment is not allowed')\r\n        $('#master-data-crud-options-form-dismiss-btn').trigger('click')\r\n      } else {\r\n        addChild(data, allData, panelCtrl)\r\n      }\r\n    } else if (e.target.id === 'update') {\r\n      if (data.type === 'Root') {\r\n        utils.alert('warning', 'Warning', 'The root is not updatable')\r\n        $('#master-data-crud-options-form-dismiss-btn').trigger('click')\r\n      } else {\r\n        updateNode(data, allData, panelCtrl)\r\n      }\r\n    } else if (e.target.id === 'delete') {\r\n      if (data.type === 'Root') {\r\n        utils.alert('warning', 'Warning', 'The root is not deletable')\r\n        $('#master-data-crud-options-form-dismiss-btn').trigger('click')\r\n      } else {\r\n        utils.showModal('delete_confirm.html')\r\n      }\r\n    }\r\n  })\r\n\r\n  $(document).on('click', '#master-data-reason-code-delete-confirmation-confirm-btn', e => {\r\n    deleteNode(data, panelCtrl)\r\n  })\r\n}\r\n\r\nfunction removeListeners () {\r\n  $(document).off('click', 'input[type=\"button\"][name=\"master-data-reason-code-actions-radio\"]')\r\n  $(document).off('click', '#master-data-reason-code-delete-confirmation-confirm-btn')\r\n}\r\n\r\nfunction deleteNode (node, panelCtrl) {\r\n  const url = utils.writeLine(node)\r\n  if (url) {\r\n    // http request\r\n    utils.deleteMethod(url).then(res => {\r\n      // console.log(res)\r\n      $('#master-data-reason-code-delete-confirmation-cancel-btn').trigger('click')\r\n      utils.alert('success', 'Deletion Success', 'The selected node and its children were successfully deleted')\r\n      panelCtrl.refresh()\r\n    }).catch(e => {\r\n      // console.log(e);\r\n      $('#master-data-reason-code-delete-confirmation-cancel-btn').trigger('click')\r\n      utils.alert('error', 'Error', 'Error occurred while deleting the node from the database, please try agian')\r\n    })\r\n  }\r\n}\r\n"]}