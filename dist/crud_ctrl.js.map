{"version":3,"sources":["../src/crud_ctrl.js"],"names":["showCrudPopup","data","panelCtrl","allData","utils","showModal","removeListeners","addListeners","$","document","on","e","target","id","type","alert","trigger","addChild","updateNode","deleteNode","off","node","url","writeLine","deleteMethod","then","refresh","catch"],"mappings":";;;;;;AAIO,WAASA,aAAT,CAAuBC,IAAvB,EAA6BC,SAA7B,EAAwCC,OAAxC,EAAgD;;AAErDC,UAAMC,SAAN,CAAgB,mBAAhB;AACAC;AACAC,iBAAaN,IAAb,EAAmBC,SAAnB,EAA8BC,OAA9B;AACD;;2BALeH,a;;AAOhB,WAASO,YAAT,CAAsBN,IAAtB,EAA4BC,SAA5B,EAAuCC,OAAvC,EAA+C;AAC7CK,MAAEC,QAAF,EAAYC,EAAZ,CAAe,OAAf,EAAwB,oEAAxB,EAA8F,aAAK;AACjG,UAAIC,EAAEC,MAAF,CAASC,EAAT,KAAgB,KAApB,EAA2B;AACzB;AACA,YAAIZ,KAAKa,IAAL,KAAc,WAAlB,EAA+B;AAC7BV,gBAAMW,KAAN,CAAY,SAAZ,EAAuB,SAAvB,EAAkC,0CAAlC;AACAP,YAAE,4CAAF,EAAgDQ,OAAhD,CAAwD,OAAxD;AACD,SAHD,MAGM;AACJC,mBAAShB,IAAT,EAAeE,OAAf,EAAwBD,SAAxB;AACD;AACF,OARD,MAQM,IAAGS,EAAEC,MAAF,CAASC,EAAT,KAAgB,QAAnB,EAA6B;AACjC,YAAIZ,KAAKa,IAAL,KAAc,MAAlB,EAA0B;AACxBV,gBAAMW,KAAN,CAAY,SAAZ,EAAuB,SAAvB,EAAkC,2BAAlC;AACAP,YAAE,4CAAF,EAAgDQ,OAAhD,CAAwD,OAAxD;AACD,SAHD,MAGM;AACJE,qBAAWjB,IAAX,EAAiBE,OAAjB,EAA0BD,SAA1B;AACD;AACF,OAPK,MAOA,IAAGS,EAAEC,MAAF,CAASC,EAAT,KAAgB,QAAnB,EAA6B;AACjC,YAAIZ,KAAKa,IAAL,KAAc,MAAlB,EAA0B;AACxBV,gBAAMW,KAAN,CAAY,SAAZ,EAAuB,SAAvB,EAAkC,2BAAlC;AACAP,YAAE,4CAAF,EAAgDQ,OAAhD,CAAwD,OAAxD;AACD,SAHD,MAGM;AACJZ,gBAAMC,SAAN,CAAgB,qBAAhB;AACD;AACF;AAEF,KAzBD;;AA2BAG,MAAEC,QAAF,EAAYC,EAAZ,CAAe,OAAf,EAAwB,0DAAxB,EAAoF,aAAK;AACvFS,iBAAWlB,IAAX,EAAiBC,SAAjB;AACD,KAFD;AAGD;;AAED,WAASI,eAAT,GAA0B;AACxBE,MAAEC,QAAF,EAAYW,GAAZ,CAAgB,OAAhB,EAAyB,oEAAzB;AACAZ,MAAEC,QAAF,EAAYW,GAAZ,CAAgB,OAAhB,EAAyB,0DAAzB;AACD;;AAED,WAASD,UAAT,CAAoBE,IAApB,EAA0BnB,SAA1B,EAAoC;AAClC,QAAMoB,MAAMlB,MAAMmB,SAAN,CAAgBF,IAAhB,CAAZ;AACA,QAAIC,GAAJ,EAAS;AACP;AACAlB,YAAMoB,YAAN,CAAmBF,GAAnB,EAAwBG,IAAxB,CAA6B,eAAO;AAClC;AACAjB,UAAE,yDAAF,EAA6DQ,OAA7D,CAAqE,OAArE;AACAZ,cAAMW,KAAN,CAAY,SAAZ,EAAuB,kBAAvB,EAA2C,8DAA3C;AACAb,kBAAUwB,OAAV;AACD,OALD,EAKGC,KALH,CAKS,aAAK;AACZ;AACAnB,UAAE,yDAAF,EAA6DQ,OAA7D,CAAqE,OAArE;AACAZ,cAAMW,KAAN,CAAY,OAAZ,EAAqB,OAArB,EAA8B,4EAA9B;AACD,OATD;AAUD;AACF;;;AAhEQE,c,mBAAAA,Q;;AACAC,gB,qBAAAA,U;;AACGd,W","file":"crud_ctrl.js","sourcesContent":["import { addChild } from './add_child_ctrl'\nimport { updateNode } from './update_node_ctrl';\nimport * as utils from './utils'\n\nexport function showCrudPopup(data, panelCtrl, allData){\n  \n  utils.showModal('crud_options.html')\n  removeListeners()\n  addListeners(data, panelCtrl, allData)\n}\n\nfunction addListeners(data, panelCtrl, allData){\n  $(document).on('click', 'input[type=\"button\"][name=\"master-data-reason-code-actions-radio\"]', e => {\n    if (e.target.id === 'add') {\n      //equipment is the last node, no chilren are allowed to be added to equipment\n      if (data.type === 'Equipment') {\n        utils.alert('warning', 'Warning', 'Adding child to Equipment is not allowed')\n        $('#master-data-crud-options-form-dismiss-btn').trigger('click')\n      }else {\n        addChild(data, allData, panelCtrl)\n      }\n    }else if(e.target.id === 'update') {\n      if (data.type === 'Root') {\n        utils.alert('warning', 'Warning', 'The root is not updatable')\n        $('#master-data-crud-options-form-dismiss-btn').trigger('click')\n      }else {\n        updateNode(data, allData, panelCtrl)\n      }\n    }else if(e.target.id === 'delete') {\n      if (data.type === 'Root') {\n        utils.alert('warning', 'Warning', 'The root is not deletable')\n        $('#master-data-crud-options-form-dismiss-btn').trigger('click')\n      }else {\n        utils.showModal('delete_confirm.html')\n      }\n    }\n\n  })\n\n  $(document).on('click', '#master-data-reason-code-delete-confirmation-confirm-btn', e => {\n    deleteNode(data, panelCtrl)\n  })\n}\n\nfunction removeListeners(){\n  $(document).off('click', 'input[type=\"button\"][name=\"master-data-reason-code-actions-radio\"]')\n  $(document).off('click', '#master-data-reason-code-delete-confirmation-confirm-btn')\n}\n\nfunction deleteNode(node, panelCtrl){\n  const url = utils.writeLine(node)\n  if (url) {\n    //http request\n    utils.deleteMethod(url).then(res => {\n      // console.log(res)\n      $('#master-data-reason-code-delete-confirmation-cancel-btn').trigger('click')\n      utils.alert('success', 'Deletion Success', 'The selected node and its children were successfully deleted')\n      panelCtrl.refresh()\n    }).catch(e => {\n      // console.log(e);\n      $('#master-data-reason-code-delete-confirmation-cancel-btn').trigger('click')\n      utils.alert('error', 'Error', 'Error occurred while deleting the node from the database, please try agian')\n    })\n  }\n}"]}